<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>è‡ºæ±ç¸£ç¨…å‹™å±€ ç¨…å‹™é—–é—œåœ’éŠæœƒ</title>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<script src="https://cdn.tailwindcss.com"></script>

<style>
:root {
    --primary: #FF6B6B;
    --secondary: #4ECDC4;
    --accent: #FFE66D;
    --success: #6BCB77;
    --wrong: #FF6B6B;
    --bg-gradient: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
}
html, body { height: 100%; margin: 0; overflow: hidden; }
body { font-family: 'Noto Sans TC', sans-serif; background: var(--bg-gradient); display: flex; justify-content: center; align-items: center; overflow-x: hidden; }

.balloon {
    position: absolute; bottom: -100px; opacity: 0.3; z-index: -1;
    animation: float-up 15s infinite ease-in; pointer-events: none;
}
@keyframes float-up { 0% { transform: translateY(0) rotate(0deg); opacity: 1; } 100% { transform: translateY(-120vh) rotate(360deg); opacity: 0; } }

.app-container {
    width: clamp(280px, 90%, 700px);
    background: rgba(255, 255, 255, 0.95);
    border-radius: 40px; padding: clamp(15px,5vw,30px);
    box-shadow: 0 30px 60px rgba(0,0,0,0.15);
    text-align: center; border: 8px solid white; position: relative; z-index: 10;
}

.grid-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: clamp(8px, 2vw, 16px);
}

.card {
    aspect-ratio: 1 / 1; border-radius: 25px;
    padding: 10px; display: flex; align-items: center; justify-content: center;
    font-weight: 900; font-size: clamp(0.9rem,2.5vw,1.3rem); cursor: pointer;
    background: #fff; border: 4px solid #f1f3f5; box-shadow: 0 8px 0 #dee2e6;
    transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    line-height: 1.4; user-select: none; color: #444;
}
.card:active { transform: translateY(4px); box-shadow: 0 4px 0 #dee2e6; }
.card.selected { border-color: var(--secondary); background: #e6fffa; transform: scale(1.05); box-shadow: 0 8px 0 #81e6d9; }
.card.matched { animation: matchPop 0.6s forwards; pointer-events: none; }
@keyframes matchPop { 50% { transform: scale(1.2) rotate(5deg); background: var(--success); color: white;  } 100% { transform: scale(0); opacity: 0; } }

/* éŒ¯èª¤æŠ–å‹•æ•ˆæœ */
@keyframes shake { 0%,100%{transform:translateX(0);} 25%{transform:translateX(-8px);} 75%{transform:translateX(8px);} }
.wrong-shake { animation: shake 0.4s; border-color: var(--wrong) !important; }

.btn-main {
    background: var(--primary); color: white;
    padding: clamp(12px,2.5vw,18px) clamp(24px,5vw,36px);
    border-radius: 50px; font-size: clamp(1rem,3vw,1.4rem); font-weight: 900;
    box-shadow: 0 8px 0 #d63031; border: none; cursor: pointer;
}
.btn-main:active { transform: translateY(4px); box-shadow: 0 4px 0 #d63031; }

#overlay {
    position: fixed; inset: 0; background: rgba(255,255,255,0.98);
    display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 1000;
}

.firework { position: absolute; border-radius: 50%; pointer-events: none; animation: explode 0.8s ease-out forwards; }

.confetti {
    position: absolute; width: 10px; height: 10px;
    animation: confetti-fall 3s linear forwards;
}
@keyframes confetti-fall { 0% { transform: translateY(-10vh) rotate(0deg); opacity: 1; } 100% { transform: translateY(110vh) rotate(720deg); opacity: 0; } }

#message-box { min-height:50px; display:flex; align-items:center; justify-content:center; transition: opacity 0.3s ease-in-out; opacity: 0; }
</style>
</head>

<body>
<div id="balloon-container"></div>

<div class="app-container">
    <div class="mb-2"><span class="bg-yellow-100 text-yellow-700 px-4 py-1 rounded-full text-sm font-black">è‡ºæ±ç¸£ç¨…å‹™å±€</span></div>
    <h1 class="text-4xl font-black text-gray-800 mb-2 tracking-tighter">ğŸ¡ ç¨…å‹™å¤§é—–é—œ</h1>
    <p class="text-gray-500 font-bold mb-4">å¿«ä¾†é…å°é ˜å¥½ç¦®ï¼æŒ‘æˆ°ä½ çš„ç¨…å‹™çŸ¥è­˜ ğŸ§ </p>

    <div class="flex justify-between items-center bg-gray-100 rounded-3xl px-6 py-3 mb-4 border-2 border-dashed border-gray-300">
        <span id="progress-text" class="font-black text-gray-700 text-lg">READY?</span>
        <span id="timer-text" class="text-xl font-mono font-bold text-red-500">00:00</span>
    </div>

    <div id="message-box" class="text-indigo-600 font-bold mb-4 bg-indigo-50 border-2 border-indigo-100 shadow-inner italic"></div>

    <div class="grid-container" id="game-grid">
        <div class="col-span-2 py-10"><p class="text-gray-400 font-bold">é»æ“Šä¸‹æ–¹æŒ‰éˆ•é–‹å§‹éŠæˆ²</p></div>
    </div>

    <div class="mt-6 flex flex-wrap justify-center gap-4">
        <button id="start-btn" class="btn-main" onclick="initGame()">GO! é–‹å§‹æŒ‘æˆ°</button>
        <button class="btn-main text-sm" onclick="exportExcel()">ğŸ“Š åŒ¯å‡ºæˆæœå ±è¡¨</button>
    </div>
</div>

<div id="overlay">
    <div class="text-6xl mb-4 animate-bounce">ğŸ†</div>
    <div class="text-5xl font-black text-gray-800 mb-2">é—–é—œå¤§æˆåŠŸï¼</div>
    <div id="result-msg" class="text-2xl text-gray-700 text-center mb-10 leading-relaxed font-bold"></div>
    <div class="relative mb-10">
        <div id="prize-icon" class="text-9xl animate-pulse">ğŸ</div>
        <div class="absolute -top-4 -right-4 bg-red-500 text-white px-4 py-1 rounded-full font-black rotate-12">çå“ GET!</div>
    </div>
    <button class="btn-main text-2xl" onclick="resetUI()">æ›ä¸‹ä¸€ä½ç©ï¼</button>
</div>

<script>
const questionBank = [
    { q: "ç‰Œç…§ç¨…ä½•æ™‚é–‹å¾µï¼Ÿ", a: "æ¯å¹´ 4 æœˆ", info: "âœ¨ æ²’éŒ¯ï¼4æœˆæ˜¯ç‰Œç…§ç¨…é–‹å¾µæœŸï¼" },
    { q: "æˆ¿å±‹ç¨…ä½•æ™‚é–‹å¾µï¼Ÿ", a: "æ¯å¹´ 5 æœˆ", info: "âœ¨ è°æ˜ï¼5æœˆå°±æ˜¯è¦ç¹³æˆ¿å±‹ç¨…å–”ï¼" },
    { q: "åœ°åƒ¹ç¨…ä½•æ™‚é–‹å¾µï¼Ÿ", a: "æ¯å¹´ 11 æœˆ", info: "âœ¨ ç­”å°äº†ï¼11æœˆæ˜¯åœ°åƒ¹ç¨…é–‹å¾µæœˆï¼" },
    { q: "åœ°åƒ¹ç¨…å„ªæƒ ç¨…ç‡ï¼Ÿ", a: "2 â€° (åƒåˆ†ä¹‹äºŒ)", info: "âœ¨ è¶…å²å®³ï¼è‡ªç”¨ä½å®…å„ªæƒ ç¨…ç‡æ˜¯2â€°ï¼" },
    { q: "è³¼è²·ç¯€èƒ½å®¶é›»ï¼Ÿ", a: "æ¸›å¾µè²¨ç‰©ç¨…", info: "âœ¨ æ²’éŒ¯ï¼çœéŒ¢ç’°ä¿é‚„èƒ½é€€ç¨…å–”ï¼" },
    { q: "é›²ç«¯ç™¼ç¥¨è¼‰å…·ï¼Ÿ", a: "ç’°ä¿åˆå¤šä¸­çæ©Ÿæœƒ", info: "âœ¨ ç­”å°äº†ï¼å­˜é›²ç«¯ç™¼ç¥¨çé …æ›´å¤šï¼" }
];

const prizes = ["ç²¾ç¾åŸå­ç­†", "å½©è‰²å£ç½©çµ„", "å¤šåŠŸèƒ½æè¢‹", "é‹å‹•æ¯›å·¾", "ç¥ç§˜å°ç¦®ç‰©"];
let completedCount = 0, firstChoice = null, isProcessing = false, startTime = null, timerInterval = null, audioCtx = null;

function createBalloons(){
    const container = document.getElementById('balloon-container');
    const colors = ['#FF6B6B', '#4ECDC4', '#FFE66D'];
    const maxBalloons = 10;
    setInterval(() => {
        if(container.children.length >= maxBalloons) return;
        const b = document.createElement('div');
        b.className = 'balloon';
        const size = Math.random() * 40 + 20;
        b.style.width = size+'px'; b.style.height = size*1.2+'px';
        b.style.left = Math.random()*100+'vw';
        b.style.backgroundColor = colors[Math.floor(Math.random()*colors.length)];
        b.style.animationDuration = Math.random()*5+8+'s';
        container.appendChild(b);
        b.addEventListener('animationend',()=>b.remove());
    },1000);
}
createBalloons();

function playNote(freq,duration=0.2,type='sine'){
    try{
        if(!audioCtx) audioCtx = new (window.AudioContext||window.webkitAudioContext)();
        if(audioCtx.state==='suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = type; osc.frequency.value = freq;
        gain.gain.setValueAtTime(0.05,audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.001,audioCtx.currentTime+duration);
        osc.connect(gain); gain.connect(audioCtx.destination);
        osc.start(); osc.stop(audioCtx.currentTime+duration);
    }catch(e){console.log("Audio disabled");}
}

function initGame(){
    completedCount=0; firstChoice=null; isProcessing=false;
    if(timerInterval) clearInterval(timerInterval);
    document.getElementById("start-btn").innerText="é‡æ–°æŒ‘æˆ°";
    const grid=document.getElementById("game-grid"); grid.innerHTML="";
    const selected=[...questionBank].sort(()=>0.5-Math.random()).slice(0,4);
    const cards=[];
    selected.forEach((item,idx)=>{
        cards.push({id:idx,text:item.q,info:item.info});
        cards.push({id:idx,text:item.a,info:item.info});
    });
    cards.sort(()=>0.5-Math.random());
    cards.forEach(cardData=>{
        const cardEl=document.createElement("div");
        cardEl.className="card";
        cardEl.innerText=cardData.text;
        cardEl.dataset.pairId=cardData.id;
        cardEl.dataset.info=cardData.info;
        cardEl.onclick=()=>handleCardClick(cardEl);
        grid.appendChild(cardEl);
    });
    startTime=Date.now(); timerInterval=setInterval(updateTimer,1000);
    updateProgress();
    showMsg("âœ¨ éŠæˆ²é–‹å§‹ï¼æ‰¾æ‰¾çœ‹é…å°åœ¨å“ªè£¡ï¼Ÿ âœ¨");
    playNote(440,0.1,'sine');
}

function handleCardClick(el){
    if(isProcessing||el.classList.contains("matched")||el===firstChoice) return;
    el.classList.add("selected"); playNote(500,0.05,'square');
    if(!firstChoice){ firstChoice=el; return; }
    isProcessing=true;
    if(firstChoice.dataset.pairId===el.dataset.pairId){
        setTimeout(()=>{
            firstChoice.classList.add("matched"); el.classList.add("matched");
            showMsg(el.dataset.info); playNote(880,0.2,'sine');
            completedCount++; updateProgress(); firstChoice=null; isProcessing=false;
            if(completedCount===4) endGame();
        },400);
    } else {
        setTimeout(()=>{
            firstChoice.classList.add("wrong-shake"); el.classList.add("wrong-shake");
            playNote(200,0.3,'sawtooth');
            setTimeout(()=>{
                firstChoice.classList.remove("selected","wrong-shake");
                el.classList.remove("selected","wrong-shake");
                firstChoice=null; isProcessing=false;
            },400);
        },300);
    }
}

function updateTimer(){
    const diff=Math.floor((Date.now()-startTime)/1000);
    const m=Math.floor(diff/60).toString().padStart(2,'0');
    const s=(diff%60).toString().padStart(2,'0');
    document.getElementById("timer-text").innerText=`${m}:${s}`;
}

function updateProgress(){ document.getElementById("progress-text").innerText=`é€²åº¦: ${completedCount} / 4`; }

function showMsg(txt){
    const box=document.getElementById("message-box");
    box.innerText=txt;
    box.style.opacity="1";
    setTimeout(()=>box.style.opacity="0",2000);
}

function createConfetti(count=50){
    for(let i=0;i<count;i++){
        const c=document.createElement('div'); c.className='confetti';
        c.style.left=Math.random()*100+'vw';
        c.style.backgroundColor=`hsl(${Math.random()*360},100%,50%)`;
        c.style.animationDelay=Math.random()*2+'s';
        document.body.appendChild(c);
        setTimeout(()=>c.remove(),4000);
    }
}

function endGame(){
    clearInterval(timerInterval);
    const usedTimeText=document.getElementById("timer-text").innerText;
    playNote(523,0.1); setTimeout(()=>playNote(659,0.1),100); setTimeout(()=>playNote(783,0.3),200);
    createConfetti(30);
    const prize=prizes[Math.floor(Math.random()*prizes.length)];
    let count=parseInt(localStorage.getItem("tt_count")||0)+1; localStorage.setItem("tt_count",count);
    let history=JSON.parse(localStorage.getItem("tt_history")||"[]");
    const now=new Date();
    history.push({"åºè™Ÿ":count,"å®Œæˆæ™‚é–“":now.toLocaleString(),"ç”¨æ™‚":usedTimeText,"ç²å¾—çå“":prize});
    localStorage.setItem("tt_history",JSON.stringify(history));
    document.getElementById("result-msg").innerHTML=`æ­å–œå®Œæˆæ‰€æœ‰é—œå¡ï¼<br>è«‹è‡³æœå‹™å°é ˜å–å°ç¦®ç‰© ğŸ`;
    document.getElementById("overlay").style.display="flex";
}

function resetUI(){
    document.getElementById("overlay").style.display="none";
    document.getElementById("game-grid").innerHTML='<div class="col-span-4 py-10"><p class="text-gray-400 font-bold">é»æ“Šä¸‹æ–¹æŒ‰éˆ•é–‹å§‹éŠæˆ²</p></div>';
    document.getElementById("progress-text").innerText="READY?";
    document.getElementById("timer-text").innerText="00:00";
    document.getElementById("message-box").style.opacity="0";
}

function exportExcel(){
    let history=JSON.parse(localStorage.getItem("tt_history")||"[]");
    if(history.length===0){ alert("ç›®å‰æ²’æœ‰éŠæˆ²ç´€éŒ„"); return; }
    const ws=XLSX.utils.json_to_sheet(history);
    const wb=XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb,ws,"éŠæˆ²ç´€éŒ„");
    XLSX.writeFile(wb,"ç¨…å‹™å±€é—–é—œç´€éŒ„.xlsx");
}
</script>
</body>
</html>
