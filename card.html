<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>è‡ºæ±ç¸£ç¨…å‹™å±€ ç¨…å‹™é—–é—œåœ’éŠæœƒ</title>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<script src="https://cdn.tailwindcss.com"></script>

<style>
/* ============================= */
/* å­—å‹èˆ‡å…¨åŸŸè‰²å½©è¨­å®š */
/* ============================= */

:root {
    --primary: #FF6B6B;    /* ä¸»è‰²ç³» */
    --secondary: #4ECDC4;  /* æ¬¡è‰²ç³» / æˆåŠŸé¸æ“‡ */
    --accent: #FFE66D;     /* å¼·èª¿è‰² */
    --success: #6BCB77;    /* æ­£ç¢ºé…å°èƒŒæ™¯ */
    --wrong: #FF6B6B;      /* éŒ¯èª¤æç¤ºè‰² */
    --bg-gradient: linear-gradient(135deg, #f6d365 0%, #fda085 100%); /* èƒŒæ™¯æ¼¸å±¤ */
}

/* ğŸ”’ é—œéµï¼šå®Œå…¨ç§»é™¤æ»¾å‹•æ¢ */
html, body {
    height: 100%;
    margin: 0;
    overflow: hidden;
}
    
body {
    font-family: 'Noto Sans TC', sans-serif; /* ä¸­æ–‡å¯è®€æ€§ä½³ */
    background: var(--bg-gradient);
    display: flex;
    justify-content: center; /* æ°´å¹³ç½®ä¸­ */
    align-items: center;     /* å‚ç›´ç½®ä¸­ */
    overflow-x: hidden;      /* é˜²æ­¢æ°´å¹³æ»¾å‹• */
}

/* ============================= */
/* èƒŒæ™¯æ°£çƒå‹•ç•« */
/* ============================= */
.balloon {
    position: absolute;
    bottom: -100px;          /* å¾åº•éƒ¨å‡ºç¾ */
    opacity: 0.3;
    z-index: -1;             /* åœ¨å®¹å™¨å¾Œæ–¹ */
    animation: float-up 15s infinite ease-in;
    pointer-events: none;    /* ä¸å½±éŸ¿é»æ“Š */
}

@keyframes float-up {
    0% { transform: translateY(0) rotate(0deg); opacity: 1; }
    100% { transform: translateY(-120vh) rotate(360deg); opacity: 0; }
}

/* ============================= */
/* ä¸­å¤®éŠæˆ²å®¹å™¨ */
/* ============================= */
.app-container {
    width: clamp(280px, 90%, 700px); /* æ‰‹æ©Ÿ-æ¡Œæ©Ÿè‡ªé©æ‡‰ */
    background: rgba(255, 255, 255, 0.95);
    border-radius: 40px;
    padding: clamp(15px,5vw,30px);
    box-shadow: 0 30px 60px rgba(0,0,0,0.15);
    text-align: center;
    border: 8px solid white;
    position: relative;
    z-index: 10;
}

/* ============================= */
/* å¡ç‰‡ Grid æ’ç‰ˆ */
/* ============================= */
.grid-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: clamp(8px, 2vw, 16px);
}

/* ============================= */
/* å¡ç‰‡æ¨£å¼ */
/* ============================= */
.card {
    aspect-ratio: 1 / 1;           /* ä¿æŒæ­£æ–¹å½¢ */
    border-radius: 25px;
    padding: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 900;
    font-size: clamp(0.9rem,2.5vw,1.3rem); /* è‡ªé©æ‡‰æ–‡å­—å¤§å° */
    cursor: pointer;
    background: #fff;
    border: 4px solid #f1f3f5;
    box-shadow: 0 8px 0 #dee2e6;
    transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    line-height: 1.4;
    user-select: none;
    color: #444;
}

/* é»æ“Šæ•ˆæœ */
.card:active { 
    transform: translateY(4px); 
    box-shadow: 0 4px 0 #dee2e6; 
}

/* é¸ä¸­å¡ç‰‡æ•ˆæœ */
.card.selected {
    border-color: var(--secondary);
    background: #e6fffa;
    transform: scale(1.05);
    box-shadow: 0 8px 0 #81e6d9;
}

/* æˆåŠŸé…å°å¡ç‰‡æ•ˆæœ */
.card.matched {
    animation: matchPop 0.6s forwards;
    pointer-events: none;
}

@keyframes matchPop {
    50% { transform: scale(1.2) rotate(5deg); background: var(--success); color: white;  }
    100% { transform: scale(0); opacity: 0; }
}
.wrong-shake {
    animation: shake 0.4s;
    border-color: var(--wrong) !important;
}

@keyframes shake {
    25% { transform: translateX(-8px); }
    75% { transform: translateX(8px); }
}

/* ============================= */
/* æŒ‰éˆ•æ¨£å¼ */
/* ============================= */
.btn-main {
    background: var(--primary);
    color: white;
    padding: clamp(12px,2.5vw,18px) clamp(24px,5vw,36px); /* ä¸Šä¸‹å·¦å³è‡ªé©æ‡‰ */
    border-radius: 50px;
    font-size: clamp(1rem,3vw,1.4rem);
    font-weight: 900;
    box-shadow: 0 8px 0 #d63031;
    border: none;
    cursor: pointer;
}

.btn-main:active { transform: translateY(4px); box-shadow: 0 4px 0 #d63031; }

/* ============================= */
/* éŠæˆ²å®Œæˆ Overlay */
/* ============================= */
#overlay {
    position: fixed;
    inset: 0;
    background: rgba(255, 255, 255, 0.98);
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 1000;
}


/* ç…™ç«æ•ˆæœ */
.firework {
    position: absolute;
    border-radius: 50%;
    pointer-events: none;
    animation: explode 0.8s ease-out forwards;
}
@keyframes explode {
    0% { transform: scale(1); opacity: 1; }
    100% { transform: translate(var(--tx), var(--ty)) scale(0); opacity: 0; }
}

/* éŒ¯èª¤æŠ–å‹•æ•ˆæœ */
@keyframes shake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-10px); }
    75% { transform: translateX(10px); }
}

/* å½©å¸¶æ‰è½æ•ˆæœ */
.confetti {
    position: absolute;
    width: 10px;
    height: 10px;
    background-color: #f00;
    animation: confetti-fall 3s linear forwards;
}
@keyframes confetti-fall {
    0% { transform: translateY(-10vh) rotate(0deg); opacity: 1; }
    100% { transform: translateY(110vh) rotate(720deg); opacity: 0; }
}

/* è¨Šæ¯æ¡† */
#message-box {
    min-height: 60px;
    transition: 0.3s;
}
</style>
</head>

<body>


<!-- èƒŒæ™¯æ°£çƒå®¹å™¨ -->
<div id="balloon-container"></div>

<!-- ä¸»éŠæˆ²å€ -->
<div class="app-container">
    <div class="mb-2">
        <span class="bg-yellow-100 text-yellow-700 px-4 py-1 rounded-full text-sm font-black">è‡ºæ±ç¸£ç¨…å‹™å±€</span>
    </div>
    <h1 class="text-4xl font-black text-gray-800 mb-2 tracking-tighter">ğŸ¡ ç¨…å‹™å¤§é—–é—œ</h1>
    <p class="text-gray-500 font-bold mb-4">å¿«ä¾†é…å°é ˜å¥½ç¦®ï¼æŒ‘æˆ°ä½ çš„ç¨…å‹™çŸ¥è­˜ ğŸ§ </p>

    <!-- é€²åº¦èˆ‡è¨ˆæ™‚å™¨ -->
    <div class="flex justify-between items-center bg-gray-100 rounded-3xl px-6 py-3 mb-4 border-2 border-dashed border-gray-300">
        <span id="progress-text" class="font-black text-gray-700 text-lg">READY?</span>
        <span id="timer-text" class="text-xl font-mono font-bold text-red-500">00:00</span>
    </div>

    <!-- éŠæˆ²æç¤ºè¨Šæ¯ -->
    <div id="message-box" class="text-indigo-600 font-bold mb-4 bg-indigo-50 border-2 border-indigo-100 shadow-inner italic opacity-0"></div>

    <!-- å¡ç‰‡ Grid -->
    <div class="grid-container" id="game-grid">
        <div class="col-span-2 py-10">
            <p class="text-gray-400 font-bold">é»æ“Šä¸‹æ–¹æŒ‰éˆ•é–‹å§‹éŠæˆ²</p>
        </div>
    </div>

    <!-- æŒ‰éˆ•å€ -->
    <div class="mt-6 flex flex-wrap justify-center gap-4">
        <button id="start-btn" class="btn-main" onclick="initGame()">GO! é–‹å§‹æŒ‘æˆ°</button>
        <button class="btn-main text-sm" onclick="exportExcel()">ğŸ“Š åŒ¯å‡ºæˆæœå ±è¡¨</button>
    </div>
</div>

<!-- éŠæˆ²å®Œæˆ Overlay -->
<div id="overlay">
    <div class="text-6xl mb-4 animate-bounce">ğŸ†</div>
    <div class="text-5xl font-black text-gray-800 mb-2">é—–é—œå¤§æˆåŠŸï¼</div>
    <div id="result-msg" class="text-2xl text-gray-700 text-center mb-10 leading-relaxed font-bold"></div>
    <div class="relative mb-10">
        <div id="prize-icon" class="text-9xl animate-pulse">ğŸ</div>
        <div class="absolute -top-4 -right-4 bg-red-500 text-white px-4 py-1 rounded-full font-black rotate-12">çå“ GET!</div>
    </div>
    <button class="btn-main text-2xl" onclick="resetUI()">æ›ä¸‹ä¸€ä½ç©ï¼</button>
</div>

<script>
// =============================
// éŠæˆ²é¡Œåº«èˆ‡çå“
// =============================
const questionBank = [
    { q: "ç‰Œç…§ç¨…ä½•æ™‚é–‹å¾µï¼Ÿ", a: "æ¯å¹´ 4 æœˆ", info: "âœ¨ æ²’éŒ¯ï¼4æœˆæ˜¯ç‰Œç…§ç¨…é–‹å¾µæœŸï¼" },
    { q: "æˆ¿å±‹ç¨…ä½•æ™‚é–‹å¾µï¼Ÿ", a: "æ¯å¹´ 5 æœˆ", info: "âœ¨ è°æ˜ï¼5æœˆå°±æ˜¯è¦ç¹³æˆ¿å±‹ç¨…å–”ï¼" },
    { q: "åœ°åƒ¹ç¨…ä½•æ™‚é–‹å¾µï¼Ÿ", a: "æ¯å¹´ 11 æœˆ", info: "âœ¨ ç­”å°äº†ï¼11æœˆæ˜¯åœ°åƒ¹ç¨…é–‹å¾µæœˆï¼" },
    { q: "åœ°åƒ¹ç¨…å„ªæƒ ç¨…ç‡ï¼Ÿ", a: "2 â€° (åƒåˆ†ä¹‹äºŒ)", info: "âœ¨ è¶…å²å®³ï¼è‡ªç”¨ä½å®…å„ªæƒ ç¨…ç‡æ˜¯2â€°ï¼" },
    { q: "è³¼è²·ç¯€èƒ½å®¶é›»ï¼Ÿ", a: "æ¸›å¾µè²¨ç‰©ç¨…", info: "âœ¨ æ²’éŒ¯ï¼çœéŒ¢ç’°ä¿é‚„èƒ½é€€ç¨…å–”ï¼" },
    { q: "é›²ç«¯ç™¼ç¥¨è¼‰å…·ï¼Ÿ", a: "ç’°ä¿åˆå¤šä¸­çæ©Ÿæœƒ", info: "âœ¨ ç­”å°äº†ï¼å­˜é›²ç«¯ç™¼ç¥¨çé …æ›´å¤šï¼" }
];

const prizes = ["ç²¾ç¾åŸå­ç­†", "å½©è‰²å£ç½©çµ„", "å¤šåŠŸèƒ½æè¢‹", "é‹å‹•æ¯›å·¾", "ç¥ç§˜å°ç¦®ç‰©"];
let completedCount = 0, firstChoice = null, isProcessing = false, startTime = null, timerInterval = null;

// èƒŒæ™¯æ°£çƒç”Ÿæˆå‡½æ•¸
// ğŸ”’ é™åˆ¶æ°£çƒæ•¸é‡ï¼Œé¿å…æ•ˆèƒ½å•é¡Œ
function createBalloons(){
    const container=document.getElementById('balloon-container');
    const colors=['#FF6B6B','#4ECDC4','#FFE66D'];
    setInterval(()=>{
        if(container.children.length>15) return;
        const b=document.createElement('div');
        b.className='balloon';
        const size=Math.random()*40+20;
        b.style.width=size+'px';
        b.style.height=size*1.2+'px';
        b.style.left=Math.random()*100+'vw';
        b.style.backgroundColor=colors[Math.floor(Math.random()*colors.length)];
        b.style.animationDuration=Math.random()*5+6+'s';
        container.appendChild(b);
        setTimeout(()=>b.remove(),8000);
    },1500);
}
createBalloons();

// éŸ³æ•ˆ
const audioCtx = new (window.AudioContext||window.webkitAudioContext)();
function playNote(freq,duration=0.2,type='sine'){
    if(audioCtx.state==='suspended') audioCtx.resume();
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.type=type; osc.frequency.setValueAtTime(freq,audioCtx.currentTime);
    gain.gain.setValueAtTime(0.2,audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.01,audioCtx.currentTime+duration);
    osc.connect(gain); gain.connect(audioCtx.destination);
    osc.start(); osc.stop(audioCtx.currentTime+duration);
}

// éŠæˆ²åˆå§‹åŒ–
function initGame(){
    completedCount=0; firstChoice=null; isProcessing=false;
    clearInterval(timerInterval);
    document.getElementById("start-btn").innerText="é‡æ–°æŒ‘æˆ°ï¼";
    const grid=document.getElementById("game-grid"); grid.innerHTML="";
    const selected=[...questionBank].sort(()=>0.5-Math.random()).slice(0,4);
    const cards=[];
    selected.forEach((item,idx)=>{cards.push({id:idx,text:item.q,info:item.info}); cards.push({id:idx,text:item.a,info:item.info});});
    cards.sort(()=>0.5-Math.random());
    cards.forEach(cardData=>{
        const cardEl=document.createElement("div");
        cardEl.className="card"; cardEl.innerText=cardData.text;
        cardEl.dataset.pairId=cardData.id; cardEl.dataset.info=cardData.info;
        cardEl.onclick=()=>handleCardClick(cardEl);
        grid.appendChild(cardEl);
    });
    startTime=Date.now();
    timerInterval=setInterval(updateTimer,1000);
    updateProgress();
    showMsg("âœ¨ éŠæˆ²é–‹å§‹ï¼æ‰¾æ‰¾çœ‹é…å°åœ¨å“ªè£¡ï¼Ÿ âœ¨");
}

// é»æ“Šå¡ç‰‡
function handleCardClick(el){
    if(isProcessing||el.classList.contains("matched")||el===firstChoice) return;
    playNote(500,0.05,'square'); el.classList.add("selected");
    if(!firstChoice){firstChoice=el;} else {
        isProcessing=true;
        if(firstChoice.dataset.pairId===el.dataset.pairId){
            setTimeout(()=>{
                playNote(880,0.2,'sine');
                firstChoice.classList.add("matched"); el.classList.add("matched");
                showMsg(el.dataset.info); completedCount++;
                updateProgress(); spawnFireworks();
                firstChoice=null; isProcessing=false;
                if(completedCount===4) endGame();
            },300);
        } else {
            setTimeout(()=>{
                playNote(200,0.3,'sawtooth');
                firstChoice.classList.add("wrong-shake"); el.classList.add("wrong-shake");
                setTimeout(()=>{
                    firstChoice.classList.remove("selected","wrong-shake");
                    el.classList.remove("selected","wrong-shake");
                    firstChoice=null; isProcessing=false;
                },400);
            },300);
        }
    }
}

function updateTimer(){
    const diff=Math.floor((Date.now()-startTime)/1000);
    const m=Math.floor(diff/60).toString().padStart(2,'0');
    const s=(diff%60).toString().padStart(2,'0');
    document.getElementById("timer-text").innerText=`${m}:${s}`;
}

function updateProgress(){document.getElementById("progress-text").innerText=`é€²åº¦: ${completedCount} / 4`;}
function showMsg(txt){const box=document.getElementById("message-box"); box.innerText=txt; box.style.opacity="1";}

function spawnFireworks(){
    const colors=['#FF6B6B','#4ECDC4','#FFE66D','#6BCB77'];
    for(let i=0;i<12;i++){
        const f=document.createElement("div");
        f.className="firework"; f.style.left="50%"; f.style.top="50%";
        f.style.width="8px"; f.style.height="8px";
        f.style.background=colors[Math.floor(Math.random()*colors.length)];
        f.style.setProperty("--tx",(Math.random()-0.5)*500+"px");
        f.style.setProperty("--ty",(Math.random()-0.5)*500+"px");
        document.body.appendChild(f);
        setTimeout(()=>f.remove(),800);
    }
}

function createConfetti(){
    for(let i=0;i<50;i++){
        const c=document.createElement('div'); c.className='confetti';
        c.style.left=Math.random()*100+'vw';
        c.style.backgroundColor=`hsl(${Math.random()*360},100%,50%)`;
        c.style.animationDelay=Math.random()*2+'s';
        document.body.appendChild(c);
        setTimeout(()=>c.remove(),4000);
    }
}

function endGame(){
    clearInterval(timerInterval); 
    //éŸ³æ•ˆ
    playNote(523,0.1); setTimeout(()=>playNote(659,0.1),100); setTimeout(()=>playNote(783,0.3),200);
    createConfetti();
    //æŠ½çå“
     const prize = prizes[Math.floor(Math.random()*prizes.length)];
    //äººæ•¸çµ±è¨ˆ
    let count=parseInt(localStorage.getItem("tt_count")||0)+1; localStorage.setItem("tt_count",count);
    
    let history=JSON.parse(localStorage.getItem("tt_history")||"[]");
    const now = new Date();
    const usedTimeText = document.getElementById("timer-text").innerText;
    const parts = usedTimeText.split(":");
    const totalSeconds = parseInt(parts[0]) * 60 + parseInt(parts[1]);
history.push({
  åºè™Ÿ: count,
  æ´»å‹•æ—¥æœŸ: now.toLocaleDateString(),
  å®Œæˆæ™‚é–“: now.toLocaleString(),
  ç”¨æ™‚(åˆ†ç§’): usedTimeText,
  ç”¨æ™‚(ç§’æ•¸): totalSeconds,
  ç²å¾—çå“: prize
});
    
    localStorage.setItem("tt_history",JSON.stringify(history));
   //é¡¯ç¤ºçµæœ
    document.getElementById("result-msg").innerHTML=
          `æ­å–œå®Œæˆæ‰€æœ‰é—œå¡ï¼<br>è«‹è‡³æœå‹™å°é ˜å–å°ç¦®ç‰© ğŸ`;
    
    document.getElementById("overlay").style.display="flex";
}

function resetUI(){
    document.getElementById("overlay").style.display="none";
    document.getElementById("game-grid").innerHTML='<div class="col-span-2 py-10"><p class="text-gray-400 font-bold">é»æ“Šä¸‹æ–¹æŒ‰éˆ•é–‹å§‹éŠæˆ²</p></div>';
    document.getElementById("progress-text").innerText="READY?";
    document.getElementById("timer-text").innerText="00:00";
    document.getElementById("message-box").style.opacity="0";
}

function exportExcel(){
    let history = JSON.parse(localStorage.getItem("tt_history") || "[]");
    if(history.length===0){
        alert("ç›®å‰æ²’æœ‰éŠæˆ²ç´€éŒ„");
        return;
    }
    
    // è¤‡è£½è³‡æ–™ï¼ˆé¿å…æ±¡æŸ“åŸå§‹è³‡æ–™ï¼‰
    let exportData = [...history];
    
    // è¨ˆç®—å¹³å‡ç§’æ•¸
    const avg = (
        history.reduce((sum, item) => sum + item["ç”¨æ™‚(ç§’æ•¸)"], 0)
        / history.length
    ).toFixed(1);

    // åŠ å…¥ç©ºç™½åˆ—
    exportData.push({
        åºè™Ÿ: "",
        æ´»å‹•æ—¥æœŸ: "",
        å®Œæˆæ™‚é–“: "",
        ç”¨æ™‚(åˆ†ç§’): "",
        ç”¨æ™‚(ç§’æ•¸): "",
        ç²å¾—çå“: "",
    });

    // åŠ å…¥çµ±è¨ˆåˆ—
    exportData.push({
        åºè™Ÿ: "çµ±è¨ˆ",
        æ´»å‹•æ—¥æœŸ: "",
        å®Œæˆæ™‚é–“: "",
        ç”¨æ™‚(åˆ†ç§’): "å¹³å‡ç§’æ•¸",
        ç”¨æ™‚(ç§’æ•¸): avg,
        ç²å¾—çå“: ""
    });

    const ws = XLSX.utils.json_to_sheet(exportData);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "éŠæˆ²ç´€éŒ„");

    XLSX.writeFile(wb, "è‡ºæ±ç¸£ç¨…å‹™å±€_é—–é—œæˆæœå ±è¡¨.xlsx");
}
    
</script>

</body>
</html>
