<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ç§Ÿç¨…å°å•ç­”</title>
<style>
/* =========================
   é•·è¼©æ¨¡å¼ï¼ˆ70+ è¶…å¤§å­—ï¼‰
   ========================= */
.elder-mode{
  font-size: 48px;
  line-height: 1.4;
}

/* æ¨™é¡Œ */
.elder-mode h1{ font-size: 56px; }
.elder-mode h2{ font-size: 52px; }

/* ä¸€èˆ¬æ–‡å­— */
.elder-mode p,
.elder-mode span,
.elder-mode li{
  font-size: 44px;
}

/* é¸é … */
.elder-mode .options{
  grid-template-columns: 1fr;
  gap: 20px;
}

.elder-mode .opt{
  font-size: 48px;
  padding: 40px 30px;
}

.elder-mode #ageBtns button,
.elder-mode #genderBtns button{
  font-size: 48px;      /* æ–‡å­—æ”¾å¤§ */
  padding: 36px 48px;   /* ä¸Šä¸‹36pxï¼Œå·¦å³48pxå¢åŠ é»æ“Šç¯„åœ */
  margin: 12px;         /* é–“è·ç¨å¤§ */
}

/* æŒ‰éˆ• */
.elder-mode button{
  font-size: 44px;
  padding: 26px 36px;
  margin: 8px 0;
}

/* é€²åº¦æ¢ */
.elder-mode .progress-container{
  height: 28px;
}

/* éš±è—ä¸å¿…è¦èªªæ˜ */
.elder-mode #quizScreen p:last-of-type{
  display: none;
}

/* ---------- å…¨å±€æ¨£å¼ ---------- */
body{
  font-family:system-ui;       /* ä½¿ç”¨ç³»çµ±å­—å‹ */
  background:#f5f7fb;          /* èƒŒæ™¯é¡è‰²ï¼šæ·¡ç°è— */
  margin:0;                    /* å»æ‰é è¨­å¤–è· */
  font-size:20px;              /* å­—é«”å¤§å° */
}

.app{
  max-width: 900px;         /* ä¸€èˆ¬è¢å¹•ã€å¹³æ¿é©ä¸­å¯¬åº¦ */
  margin: 40px auto;        /* ä¸Šä¸‹ç•™ç™½ã€å·¦å³ç½®ä¸­ */
  background: #fff;         /* ç™½è‰²å¡ç‰‡èƒŒæ™¯ */
  border-radius: 16px;      /* åœ“è§’ */
  padding: 24px;            /* å…§è· */
  box-shadow: 0 10px 30px rgba(0,0,0,.08); /* æŸ”å’Œé™°å½± */
}

/* =========================
   æ¡Œä¸Šå‹é›»è…¦ï¼ˆä¸€èˆ¬æ¡Œé›»ï¼‰
   è¢å¹•å¯¬åº¦ 1024px ä»¥ä¸Š
   ========================= */
@media (min-width: 1024px){
  .app{
    max-width: 1200px;      /* æ¡Œé›»ç•«é¢æ”¾å¯¬ */
    padding: 40px;          /* å¢åŠ é–±è®€èˆ’é©åº¦ */
  }
}


/* =========================
   è¶…å¤§è¢å¹•æ¡Œé›»ï¼ˆé¸ç”¨ï¼‰
   è¢å¹•å¯¬åº¦ 1440px ä»¥ä¸Š
   ========================= */
@media (min-width: 1440px){
  .app{
    max-width: 1400px;      /* å¤§è¢å¹•ä¸é¡¯å¾—éçª„ */
  }
}

/* =========================
   å°å°ºå¯¸æ‰‹æ©Ÿï¼ˆé¸ç”¨ï¼‰
   ========================= */
@media (max-width: 480px){
  .app{
    margin: 16px;           /* é¿å…è²¼é½Šé‚Šæ¡† */
    padding: 20px;          /* æ‰‹æ©Ÿé–±è®€è¼ƒèˆ’æœ */
  }
}

.hidden{display:none}           /* éš±è—å…ƒç´  */

.options{
  display:grid;                 /* é¸é …ä½¿ç”¨ grid æ’åˆ— */
  grid-template-columns:1fr 1fr; /* æ¯è¡Œå…©å€‹é¸é … */
  gap:12px;                     /* é¸é …é–“è· */
  margin-top:12px;              /* ä¸Šæ–¹é–“è· */
}

.opt{
  border:1px solid #ddd;        /* é‚Šæ¡†é¡è‰² */
  border-radius:12px;           /* åœ“è§’ */
  padding:16px;                 /* å…§è· */
  cursor:pointer;               /* æ»‘é¼ è®Šæ‰‹å½¢ */
  text-align:center;            /* æ–‡å­—ç½®ä¸­ */
  font-size: 20px;              /* æ–‡å­—å¤§å° */
}

@media (hover: hover) and (pointer: fine) {
  .opt:hover {
    background:#eef2ff;			 /* æ»‘é¼  hover é¡è‰²ï¼šæ·¡è— */
  }
}

.opt{
  background:#fff;   /* ç¢ºä¿æ–°é¡Œç›®ä¸€å®šæ˜¯ç™½çš„ */
}

button{
  padding:12px 18px;            /* æŒ‰éˆ•å…§è· */
  border-radius:10px;           /* æŒ‰éˆ•åœ“è§’ */
  border:none;                  /* ç§»é™¤é è¨­é‚Šæ¡† */
  cursor:pointer;               /* æ»‘é¼ è®Šæ‰‹å½¢ */
  font-size: 18px;              /* æŒ‰éˆ•æ–‡å­—å¤§å° */
}

/* ---------- æŒ‰éˆ•é¡è‰² ---------- */
.primary{
  background:#4f6ef7;           /* ä¸»è¦æŒ‰éˆ•è—è‰² */
  color:#fff;                   /* æ–‡å­—ç™½è‰² */
}

.secondary{
  background:#eee;              /* æ¬¡è¦æŒ‰éˆ•ç°è‰² */
}

/* ---------- å€’æ•¸è¨ˆæ™‚ ---------- */
.time{
  font-weight:bold;              /* ç²—é«” */
  color:#f33;                    /* ç´…è‰² */
  margin-left:8px;               /* å·¦å´é–“è· */
}

/* ---------- é€²åº¦æ¢ ---------- */
.progress-container{
  background:#eee;              /* å¤–æ¡†é¡è‰²ç°è‰² */
  border-radius:8px;            /* åœ“è§’ */
  overflow:hidden;              /* é¿å…é€²åº¦æ¢æº¢å‡º */
  margin-top:6px;               /* ä¸Šæ–¹é–“è· */
  height:16px;                  /* é«˜åº¦ */
}

.progress-bar{
  height:100%;                  /* ä½”æ»¿å®¹å™¨é«˜åº¦ */
  width:100%;                   /* åˆå§‹æ»¿å¯¬ */
  transition:width 0.2s linear; /* å¯¬åº¦è®ŠåŒ–å‹•ç•« */
  background:linear-gradient(to right,#4f6ef7,#78a1ff); /* æ¼¸å±¤è—è‰² */
}

/* ---------- ç­”é¡Œæª¢è¨ ---------- */
.review ul{
  padding-left:20px;            /* å·¦å´ç¸®æ’ */
  margin-top:8px;               /* ä¸Šæ–¹é–“è· */
}

.review li{
  margin-bottom:6px;            /* åˆ—é–“è· */
}

/* ---------- è¡¨å–®æ¨£å¼ ---------- */
label{
  display:block;                /* è®Šæˆå€å¡Š */
  margin:8px 0 4px;             /* ä¸Š8pxï¼Œä¸‹4px */
}

select{
  padding:6px;                  /* å…§è· */
  border-radius:8px;            /* åœ“è§’ */
  border:1px solid #ccc;        /* é‚Šæ¡†é¡è‰² */
}
</style>
</head>
<body>
<div class="app">
<button id="elderBtn" class="primary" onclick="toggleElderMode()" style="float:right">
  ğŸ‘´ é•·è¼©æ¨¡å¼
</button>
<h1>ç§Ÿç¨…å°å•ç­”</h1>
<p>æ¯äºº 3 é¡Œï½œæ¯é¡Œ 10 ç§’</p>

<!-- ---------- éŠæˆ²é–‹å§‹ç•«é¢ ---------- -->
<div id="startScreen">
<p>è«‹é¸æ“‡å¹´é½¡ï¼š</p>
<div id="ageBtns">
  <!-- å¹´é½¡æŒ‰éˆ•ï¼Œæ¯å€‹æŒ‰éˆ•é»æ“Šæœƒå‘¼å« setAge å‡½å¼ -->
  <button data-value="10-19" onclick="setAge('10-19', this)">10-19</button>
  <button data-value="20-29" onclick="setAge('20-29', this)">20-29</button>
  <button data-value="30-39" onclick="setAge('30-39', this)">30-39</button>
  <button data-value="40-49" onclick="setAge('40-49', this)">40-49</button>
  <button data-value="50-59" onclick="setAge('50-59', this)">50-59</button>
  <button data-value="60-69" onclick="setAge('60-69', this)">60-69</button>
  <button data-value="70-79" onclick="setAge('70-79', this)">70-79</button>
  <button data-value="80+" onclick="setAge('80+', this)">80ä»¥ä¸Š</button>
</div>

<p>è«‹é¸æ“‡æ€§åˆ¥ï¼š</p>
<div id="genderBtns">
  <!-- æ€§åˆ¥æŒ‰éˆ• -->
  <button data-value="ç”·ç”Ÿ" onclick="setGender('ç”·ç”Ÿ', this)">ç”·ç”Ÿ</button>
  <button data-value="å¥³ç”Ÿ" onclick="setGender('å¥³ç”Ÿ', this)">å¥³ç”Ÿ</button>
</div>

<!-- é–‹å§‹ä½œç­”æŒ‰éˆ•ï¼Œæœƒé©—è­‰æ˜¯å¦é¸æ“‡å¹´é½¡èˆ‡æ€§åˆ¥ -->
<button class="primary" onclick="startGame()">é–‹å§‹ä½œç­”</button>
</div>

<!-- ---------- ä½œç­”ç•«é¢ ---------- -->
<div id="quizScreen" class="hidden">
<div>
  ç¬¬ <span id="qIndex"></span> / 3 é¡Œï½œ
  å‰©é¤˜ <span id="time">10</span> ç§’
</div>
<div class="progress-container">
  <div id="progressBar" class="progress-bar"></div>
</div>
<h2 id="question"></h2>
<div class="options" id="options"></div>
</div>

<!-- ---------- ä½œç­”çµæœç•«é¢ ---------- -->
<div id="resultScreen" class="hidden">
<h2>ä½œç­”çµæœ</h2>
<p>æ­£ç¢ºç‡ï¼š<b><span id="rate"></span>%</b></p>
<div class="review">
    <h3>ç­”éŒ¯é¡Œç›®èˆ‡æ­£ç¢ºç­”æ¡ˆ</h3>
    <ul id="reviewBody"></ul>
</div>
<div class="controls">
<button class="primary" onclick="nextPlayer()">ä¸‹ä¸€ä½</button>
<button class="secondary" onclick="exportAllCSV()">åŒ¯å‡º CSV</button>
<button class="secondary" onclick="clearAllData()">æ¸…ç©ºæ‰€æœ‰è³‡æ–™</button>
</div>
</div>

<script>
function toggleElderMode(){
  document.body.classList.toggle('elder-mode');
  const btn = document.getElementById('elderBtn');
  btn.textContent = document.body.classList.contains('elder-mode')
    ? 'ğŸ‘¦ ä¸€èˆ¬æ¨¡å¼'
    : 'ğŸ‘´ é•·è¼©æ¨¡å¼';
}
// ---------- é¡Œåº« ---------- 
const QUESTION_BANK = [
          {q:"æˆ¿å±‹ç¨…ç´ç¨…ç¾©å‹™åŸºæº–æ—¥æ˜¯å“ªä¸€æ—¥ï¼Ÿ",options:["2æœˆæœ«æ—¥","3æœˆ22æ—¥","9æœˆ22æ—¥"],correct:0},
	{q:"æˆ¿å±‹ä½¿ç”¨æƒ…å½¢è®Šæ›´éœ€åœ¨å“ªä¸€å¤©å‰æå‡ºç”³è«‹ï¼Ÿ",options:["3æœˆ22æ—¥","7æœˆ22æ—¥","9æœˆ22æ—¥"],correct:0},
	{q:"å…¨åœ‹å–®ä¸€è‡ªä½æˆ¿å±‹ï¼Œç¨…ç‡æ˜¯å¤šå°‘ï¼Ÿ",options:["1%","1.2%","1.5%"],correct:0},
	{q:"ä½å®¶ç”¨æˆ¿å±‹ç¾å€¼10è¬å…ƒä»¥ä¸‹å…ç¨…ï¼Œé©ç”¨å°è±¡ï¼Ÿ",options:["æ³•äºº","è‡ªç„¶äºº","ä»¥ä¸Šçš†å¯ä»¥é©ç”¨"],correct:1},
	{q:"ä½å®¶ç”¨æˆ¿å±‹ç¾å€¼10è¬å…ƒä»¥ä¸‹å…ç¨…ï¼Œå…¨åœ‹æœ€å¤šå¹¾æˆ¶ï¼Ÿ",options:["1æˆ¶","3æˆ¶","5æˆ¶"],correct:1},
	{q:"æˆ¿å±‹ç¨…2.0æ–°åˆ¶ï¼Œå°æ–¼è‡ªä½æˆ¿å±‹é©ç”¨æ¢ä»¶å¢è¨‚ä»€éº¼è¦å®šï¼Ÿ",options:["æˆ¿å±‹ä¸å¯å‡ºç§Ÿæˆ–ä¾›ç‡Ÿæ¥­ä½¿ç”¨","ä¾›æœ¬äººã€é…å¶æˆ–ç›´ç³»è¦ªå±¬å¯¦éš›å±…ä½ä½¿ç”¨","è¾¦ç«£æˆ¶ç±ç™»è¨˜"],correct:2},
	{q:"æˆ¿å±‹ç¨…2.0æ–°åˆ¶ï¼Œè‡ªä½æˆ¿å±‹å¢è¨‚æˆ¶ç±ç™»è¨˜ä¹‹å°è±¡å¯ä»¥æ˜¯èª°ï¼Ÿ",options:["æœ¬äºº","é…å¶","ç›´ç³»è¦ªå±¬","ä»¥ä¸Šçš†æ˜¯"],correct:3},
	{q:"ç•¶å¹´æˆ¿å±‹è¦é©ç”¨è‡ªä½ç¨…ç‡ï¼Œéœ€åœ¨ä»€éº¼æ™‚é–“å‰è¾¦ç«£æˆ¶ç±ç™»è¨˜ï¼Ÿ",options:["3æœˆ22æ—¥","9æœˆ22æ—¥"],correct:0},
	{q:"æˆ¿å±‹ç¨…ç”±æŒ‰æœˆè¨ˆå¾µï¼Œè®ŠæˆæŒ‰ä»€éº¼è¨ˆå¾µï¼Ÿ",options:["æŒ‰å¹´","æŒ‰æ—¥"],correct:0},
	{q:"è‡ªä½æˆ¿å±‹ç¨…ç‡1.2ï¼…çš„æˆç«‹è¦ä»¶ç‚ºä½•ï¼Ÿ",options:["æˆ¿å±‹ç„¡å‡ºç§Ÿæˆ–ä¾›ç‡Ÿæ¥­æƒ…å½¢","ä¾›æœ¬äººã€é…å¶æˆ–ç›´ç³»è¦ªå±¬å¯¦éš›å±…ä½ä½¿ç”¨ï¼Œä¸”æ‡‰æ–¼è©²å±‹è¾¦ç«£æˆ¶ç±ç™»è¨˜","æœ¬äººã€é…å¶åŠæœªæˆå¹´å­å¥³å…¨åœ‹åˆè¨ˆ3æˆ¶","ä»¥ä¸Šçš†æ˜¯"],correct:3},
	{q:"å…¨åœ‹å–®ä¸€è‡ªä½æˆ¿å±‹ç¨…ç‡1%çš„æˆç«‹è¦ä»¶ç‚ºä½•ï¼Ÿ",options:["æˆ¿å±‹ç„¡å‡ºç§Ÿæˆ–ä¾›ç‡Ÿæ¥­æƒ…å½¢","ä¾›æœ¬äººã€é…å¶æˆ–ç›´ç³»è¦ªå±¬å¯¦éš›å±…ä½ä½¿ç”¨ï¼Œä¸”æ‡‰æ–¼è©²å±‹è¾¦ç«£æˆ¶ç±ç™»è¨˜","æœ¬äººã€é…å¶åŠæœªæˆå¹´å­å¥³æ–¼å…¨åœ‹åƒ…æŒæœ‰1æˆ¶æˆ¿å±‹","æˆ¿å±‹ç¾å€¼åœ¨ä¸€å®šé‡‘é¡ä»¥ä¸‹","ä»¥ä¸Šçš†æ˜¯"],correct:4},
	{q:"æ³•äººæŒæœ‰ä½å®¶ç”¨æˆ¿å±‹ç¾å€¼10è¬å…ƒä»¥ä¸‹æ˜¯å¦é©ç”¨å…ç¨…è¦å®šï¼Ÿ",options:["æ˜¯","å¦"],correct:1},
	{q:"æˆ¿å±‹ä½¿ç”¨æƒ…å½¢è®Šæ›´ï¼Œç¶“æ ¸å®šå¾Œï¼Œæœªå†è®Šæ›´ï¼Œæ˜¯å¦éœ€å†ç”³å ±ï¼Ÿ",options:["æ˜¯","å¦"],correct:1},
	{q:"éè‡ªä½æˆ¿å±‹åœ¨éå…­éƒ½ä¹‹ç¨…ç‡ç‚ºä½•ï¼Ÿ",options:["3ï¼…~5ï¼…","2.6ï¼…~4.8ï¼…","3.2ï¼…~4.8ï¼…"],correct:1},
	{q:"éè‡ªä½æˆ¿å±‹åœ¨å…­éƒ½ä¹‹ç¨…ç‡ç‚ºä½•ï¼Ÿ",options:["2.6ï¼…~4.8ï¼…","3ï¼…~5ï¼…","3.2ï¼…~4.8ï¼…"],correct:2},
	{q:"ç¹¼æ‰¿å–å¾—ä¹‹å…±æœ‰æˆ¿å±‹ç¨…ç‡ç‚ºä½•ï¼Ÿ",options:["3.2ï¼…~4.8ï¼…","2.6ï¼…~4.8ï¼…","1.5ï¼…~2.4ï¼…"],correct:2},
	{q:"å»ºå•†å¾…éŠ·å”®æˆ¿å±‹ç¨…ç‡ç‚ºä½•ï¼Ÿ",options:["2ï¼…~4.8ï¼…","3ï¼…~5ï¼…","1.5ï¼…~2.4ï¼…"],correct:0},
	{q:"æˆ¿å±‹å‡ºç§Ÿç”³å ±ç§Ÿè³ƒæ‰€å¾—é”ç§Ÿé‡‘æ¨™æº–ç¨…ç‡ç‚ºä½•ï¼Ÿ",options:["1.5ï¼…~2.4ï¼…","2.6ï¼…~4.8ï¼…","3.2ï¼…~4.8ï¼…"],correct:0},
	{q:"éè‡ªä½æˆ¿å±‹æˆ¶æ•¸è¨ˆç®—æ˜¯ç¸£å¸‚æ­¸æˆ¶é‚„æ˜¯å…¨åœ‹æ­¸æˆ¶ï¼Ÿ",options:["ç¸£å¸‚æ­¸æˆ¶","å…¨åœ‹æ­¸æˆ¶"],correct:1},
	{q:"éè‡ªä½æˆ¿å±‹æ˜¯ä»¥å€‹äººé‚„æ˜¯å®¶æˆ¶ä¾†è¨ˆç®—æŒæœ‰æˆ¶æ•¸ï¼Ÿ",options:["å€‹äºº","å®¶æˆ¶"],correct:0},
	{q:"ä½¿ç”¨ç‰Œç…§ç¨…å¹¾æœˆè¦ç¹³ç´?",options:["4æœˆ","5æœˆ"],correct:0},
	{q:"åœ°åƒ¹ç¨…å¹¾æœˆè¦ç¹³ç´?",options:["9æœˆ","11æœˆ"],correct:1},
	{q:"åœ°åƒ¹ç¨…è‡ªç”¨ä½å®…å„ªæƒ ç¨…ç‡æ˜¯å¤šå°‘?",options:["åƒåˆ†ä¹‹äºŒ","åƒåˆ†ä¹‹å"],correct:0},
	{q:"å°æ˜æœ‰5è¼›è»Šï¼Œå¯ä»¥ç”³è«‹åªåˆ°ä¸€å¼µç¨…å–®å—?",options:["ä¸å¯ä»¥","å¯ä»¥"],correct:1},
	{q:"åœ°åƒ¹ç¨…è‡ªç”¨ä½å®…å„ªæƒ ç¨…ç‡å¹¾æœˆå¹¾æ—¥å‰æå‡ºç”³è«‹,ç•¶å¹´åº¦å³é©ç”¨?",options:["3æœˆ22æ—¥","9æœˆ22æ—¥"],correct:1}
];

// ---------- éŠæˆ²ç‹€æ…‹è®Šæ•¸ ---------- 
let allRecords=[], selected=[], idx=0, timer, timeLeft=15, answers=[], player=0, currentRate=0;
let playerInfo={age:'', gender:''};
let ageSelected=null, genderSelected=null;


// ---------- å·¥å…·å‡½å¼ ----------
function shuffle(a){ return a.sort(()=>Math.random()-0.5); }
function highlightButton(containerId, selectedBtn){
  const container=document.getElementById(containerId);
  Array.from(container.children).forEach(btn=>{btn.style.background=''; btn.style.color='';});
  if(selectedBtn){ selectedBtn.style.background='#4f6ef7'; selectedBtn.style.color='#fff'; }
}

function resetOptionState(){
  const optionsDivs = document.getElementById('options').children;
  Array.from(optionsDivs).forEach(d=>{
    d.style.background = '';
    d.style.color = '';
    d.style.pointerEvents = 'auto';
  });

  const progressBar = document.getElementById('progressBar');
  progressBar.style.background = '#4f6ef7';
}

// ---------- é¸æ“‡å¹´é½¡/æ€§åˆ¥ï¼ˆæ»‘é¼ ï¼‰ ----------
function setAge(age, btn){ ageSelected=age; highlightButton('ageBtns', btn); }
function setGender(gender, btn){ genderSelected=gender; highlightButton('genderBtns', btn); }

// ---------- é–‹å§‹éŠæˆ² ----------
function startGame(){
  if(!ageSelected || !genderSelected){ alert('è«‹å…ˆé¸æ“‡å¹´é½¡èˆ‡æ€§åˆ¥'); return; }
  playerInfo={age:ageSelected, gender:genderSelected};
  player++;
  selected=shuffle([...QUESTION_BANK]).slice(0,3);
  idx=0; answers=[];
  document.getElementById('startScreen').classList.add('hidden');
  document.getElementById('quizScreen').classList.remove('hidden');
  showQ();
}

// ---------- é¡¯ç¤ºé¡Œç›® ----------
function showQ(){
  resetOptionState();

  const q=selected[idx];
  document.getElementById('qIndex').textContent=idx+1;
  document.getElementById('question').textContent=q.q;
  const box=document.getElementById('options'); box.innerHTML='';
  q.options.forEach((o,i)=>{
    const d=document.createElement('div');
    d.className='opt';
    d.textContent=(i+1)+'. '+o;
    d.onclick=()=>highlightAnswer(i);
    box.appendChild(d);
  });
  startTimer();
}

// ---------- å€’æ•¸è¨ˆæ™‚ ----------
function startTimer(){
  clearInterval(timer);
  timeLeft=15;
  const progressBar=document.getElementById('progressBar');
  progressBar.style.width='100%'; progressBar.style.background='#4f6ef7';
  document.getElementById('time').textContent=timeLeft;
  timer=setInterval(()=>{
    timeLeft-=0.1; if(timeLeft<0) timeLeft=0;
    document.getElementById('time').textContent=Math.ceil(timeLeft);
    const percent=(timeLeft/15)*100; progressBar.style.width=percent+'%';
    if(timeLeft>10){progressBar.style.background='#4f6ef7';}
    else if(timeLeft>5){progressBar.style.background='#ffc107';}
    else{progressBar.style.background='#f33';}
    if(timeLeft<=0){ clearInterval(timer); highlightAnswer(null);}
  },100);
}

// ---------- é«˜äº®ä½œç­”é¸é … ----------
function highlightAnswer(choice){
  clearInterval(timer);
  const q=selected[idx];
  const optionsDivs=document.getElementById('options').children;
  const progressBar=document.getElementById('progressBar');
  progressBar.style.background='#999';
  Array.from(optionsDivs).forEach(d=>d.style.pointerEvents='none');
  if(choice!==null){
    if(choice===q.correct){ optionsDivs[choice].style.background='#4CAF50'; optionsDivs[choice].style.color='#fff'; }
    else{ optionsDivs[choice].style.background='#f33'; optionsDivs[choice].style.color='#fff';
          optionsDivs[q.correct].style.background='#4CAF50'; optionsDivs[q.correct].style.color='#fff';}
  } else { optionsDivs[q.correct].style.background='#4CAF50'; optionsDivs[q.correct].style.color='#fff'; }
  setTimeout(()=>choose(choice),500);
}

// ---------- ç´€éŒ„ä½œç­” ----------
function choose(i){
  const q=selected[idx];
  const now=new Date();
  const dateTime=now.getFullYear()+'-'+String(now.getMonth()+1).padStart(2,'0')+'-'+String(now.getDate()).padStart(2,'0')+
                 ' '+String(now.getHours()).padStart(2,'0')+':'+String(now.getMinutes()).padStart(2,'0')+':'+String(now.getSeconds()).padStart(2,'0');
  answers.push({
    player:'ç¬¬'+player+'ä½',
    age:playerInfo.age,
    gender:playerInfo.gender,
    question:q.q,
    chosen:i,
    correct:q.correct,
    chosenText:i===null?'æœªä½œç­”':q.options[i],
    correctText:q.options[q.correct],
    dateTime:dateTime
  });
  idx++;
  if(idx>=selected.length){
    const correctCount=answers.filter(a=>a.chosen===a.correct).length;
    const rate=Math.round(correctCount/answers.length*100);
    answers.forEach(a=>a.rate=rate); currentRate=rate;
    allRecords.push(...answers);
    showResult();
  } else { showQ(); }
}

// ---------- é¡¯ç¤ºçµæœ ----------
function showResult(){
  document.getElementById('quizScreen').classList.add('hidden');
  document.getElementById('resultScreen').classList.remove('hidden');
  document.getElementById('rate').textContent=currentRate;
  const review=document.getElementById('reviewBody'); review.innerHTML='';
  answers.forEach(a=>{
    if(a.chosen!==a.correct){
      const li=document.createElement('li');
      li.textContent=`${a.question} æ­£ç¢ºç­”æ¡ˆï¼š${a.correct+1}.${a.correctText}`;
      review.appendChild(li);
    }
  });
}

// ---------- ä¸‹ä¸€ä½ç©å®¶ ----------
function nextPlayer(){
  ageSelected=null; genderSelected=null;
  highlightButton('ageBtns', null); highlightButton('genderBtns', null);
  document.getElementById('resultScreen').classList.add('hidden');
  document.getElementById('startScreen').classList.remove('hidden');
}

// ---------- åŒ¯å‡º CSV ----------
function exportAllCSV(){
  if(!allRecords.length){alert('ç„¡è³‡æ–™'); return;}
  const rows=[['ä½œç­”æ—¥æœŸæ™‚é–“','ä½œç­”è€…','å¹´é½¡','æ€§åˆ¥','é¡Œç›®','ä½ çš„ç­”æ¡ˆç·¨è™Ÿ','ä½ çš„ç­”æ¡ˆæ–‡å­—','æ­£ç¢ºç­”æ¡ˆç·¨è™Ÿ','æ­£ç¢ºç­”æ¡ˆæ–‡å­—','æ˜¯å¦æ­£ç¢º','æ­£ç¢ºç‡']];
  allRecords.forEach(r=>{
    const yourNo=r.chosen===null?'':r.chosen+1;
    const corrNo=r.correct+1;
    const correctFlag=r.chosen===r.correct?'æ˜¯':'å¦';
    rows.push([r.dateTime,r.player,r.age,r.gender,r.question,yourNo,r.chosenText,corrNo,r.correctText,correctFlag,r.rate]);
  });

  // è¨ˆç®—æ¯é¡ŒéŒ¯èª¤ç‡
  const qErrorMap = {};
  allRecords.forEach(r=>{
    if(!qErrorMap[r.question]) qErrorMap[r.question]={wrong:0,total:0};
    if(r.chosen!==r.correct) qErrorMap[r.question].wrong++;
    qErrorMap[r.question].total++;
  });
  rows.push([]);
  rows.push(['é¡Œç›®','éŒ¯èª¤ç‡(%)']);
  Object.keys(qErrorMap).forEach(q=>{
    const err = Math.round(qErrorMap[q].wrong/qErrorMap[q].total*100);
    rows.push([q,err]);
  });

  const safeText=c=>c?c.toString().replace(/\r?\n/g,' '):'';
  const csv=rows.map(r=>r.map(c=>`"${safeText(c)}"`).join(',')).join('\n');

// âœ… åŠ ä¸Š UTF-8 BOMï¼Œé¿å… Excel ä¸­æ–‡äº‚ç¢¼
  const blob = new Blob(["\uFEFF" + csv], { type: 'text/csv;charset=utf-8' });
  const a = document.createElement('a'); 
  a.href = URL.createObjectURL(blob); 

// ä½¿ç”¨æ™‚é–“æˆ³æª”åï¼Œé¿å…å¤šäººä½œç­”è¦†è“‹
  const now = new Date();
  const filename = `ç§Ÿç¨…å°å•ç­”_${now.getFullYear()}-${String(now.getMonth()+  1).padStart(2,'0')}-${String(now.getDate()).padStart(2,'0')}.csv`;
  a.download = filename;

  a.click();
}

// ---------- æ¸…ç©ºè³‡æ–™ ----------
function clearAllData(){ if(confirm('ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰è³‡æ–™å—ï¼Ÿ')) allRecords=[]; }

// ---------- ä½œç­”éµç›¤æ“ä½œ 1~4 ----------
document.addEventListener('keydown', e=>{
  const key=parseInt(e.key); if(isNaN(key)) return;
  if(!document.getElementById('quizScreen').classList.contains('hidden')){
    const optionsDivs=document.getElementById('options').children;
    if(key>=1 && key<=optionsDivs.length) highlightAnswer(key-1);
  }
});
</script>
</div>
</body>
</html>
